# Supabase認証移行完了チェックリスト

このチェックリストを使用して、Supabase認証への移行が正常に完了したことを確認してください。

## 🚀 Phase 1: Supabaseプロジェクトの準備

### 1.1 Supabaseプロジェクトの作成

- [ ] Supabaseアカウントを作成
- [ ] 新しいプロジェクトを作成
- [ ] プロジェクト名を設定（例：`subsc-manager`）
- [ ] データベースパスワードを設定
- [ ] リージョンを選択（推奨：`Asia Pacific (Tokyo)`）

### 1.2 認証設定

- [ ] Authentication > Settingsにアクセス
- [ ] Email Authを有効化
- [ ] Confirm emailを無効化（開発中）
- [ ] Secure email changeを無効化（開発中）
- [ ] パスワードポリシーを確認

### 1.3 環境変数の取得

- [ ] Settings > APIにアクセス
- [ ] Project URLをコピー
- [ ] anon public keyをコピー
- [ ] service_role keyをコピー（必要に応じて）

## 🔧 Phase 2: 環境設定

### 2.1 環境変数の設定

- [ ] `.env`ファイルを作成/更新
- [ ] `NEXT_PUBLIC_SUPABASE_URL`を設定
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`を設定
- [ ] `DATABASE_URL`をSupabase PostgreSQLに更新
- [ ] 既存のJWT関連環境変数を削除

### 2.2 データベース接続の確認

- [ ] `npx prisma generate`を実行
- [ ] `npx prisma db push`を実行
- [ ] データベース接続が成功することを確認
- [ ] テーブルが正しく作成されることを確認

## 🔄 Phase 3: 認証システムの移行

### 3.1 Supabase認証サービスの確認

- [ ] `SupabaseAuthService`が完全に実装されている
- [ ] サインアップ機能が動作する
- [ ] サインイン機能が動作する
- [ ] サインアウト機能が動作する
- [ ] セッション取得機能が動作する
- [ ] パスワードリセット機能が動作する
- [ ] パスワード更新機能が動作する

### 3.2 認証ミドルウェアの確認

- [ ] `SupabaseAuthMiddleware`が実装されている
- [ ] 認証機能が動作する
- [ ] エラーハンドリングが適切に実装されている

### 3.3 APIエンドポイントの確認

- [ ] `/api/auth/supabase-login`が実装されている
- [ ] `/api/auth/supabase-register`が実装されている
- [ ] APIエンドポイントが正常に動作する
- [ ] エラーレスポンスが適切に返される

## 🎨 Phase 4: フロントエンドの統合

### 4.1 認証コンテキストの確認

- [ ] `UnifiedAuthContext`が実装されている
- [ ] 認証状態が正しく管理される
- [ ] セッション復元が動作する
- [ ] ログアウト時に状態がクリアされる

### 4.2 UIコンポーネントの確認

- [ ] `SupabaseLoginForm`が実装されている
- [ ] `SupabaseRegisterForm`が実装されている
- [ ] `SupabaseAuthModal`が実装されている
- [ ] フォームのバリデーションが動作する
- [ ] エラーメッセージが適切に表示される
- [ ] ローディング状態が適切に表示される

### 4.3 既存コンポーネントの更新

- [ ] 既存の認証コンポーネントが新しいコンテキストを使用
- [ ] インポート文が正しく更新されている
- [ ] 型エラーが解消されている

## 📊 Phase 5: データ移行

### 5.1 移行スクリプトの確認

- [ ] `scripts/migrate-to-supabase.ts`が実装されている
- [ ] 移行スクリプトが正常に動作する
- [ ] エラーハンドリングが適切に実装されている

### 5.2 データ移行の実行

- [ ] 既存データのバックアップを作成
- [ ] 移行スクリプトを実行
- [ ] ユーザーデータが正常に移行される
- [ ] サブスクリプションデータが正常に移行される
- [ ] 移行結果を検証

### 5.3 データ整合性の確認

- [ ] 移行後のデータが正しいことを確認
- [ ] リレーションシップが正しく保持されている
- [ ] データ型が正しく変換されている

## 🧪 Phase 6: テストと検証

### 6.1 自動テストの確認

- [ ] `npm test`が正常に実行される
- [ ] 新しいテストが追加されている
- [ ] 既存のテストが更新されている
- [ ] テストカバレッジが適切

### 6.2 手動テストの実行

- [ ] ユーザー登録が正常に動作する
- [ ] ログインが正常に動作する
- [ ] ログアウトが正常に動作する
- [ ] パスワードリセットが正常に動作する
- [ ] サブスクリプション管理機能が正常に動作する
- [ ] カレンダー表示が正常に動作する
- [ ] 為替レート変換が正常に動作する

### 6.3 エラーケースのテスト

- [ ] 無効なメールアドレスでの登録
- [ ] 無効なパスワードでのログイン
- [ ] 存在しないユーザーでのログイン
- [ ] ネットワークエラー時の動作
- [ ] セッション切れ時の動作

## 🧹 Phase 7: クリーンアップ

### 7.1 不要なコードの削除

- [ ] JWT認証関連ファイルを削除
- [ ] 既存の認証APIエンドポイントを削除
- [ ] 既存の認証コンテキストを削除
- [ ] 既存の認証コンポーネントを削除
- [ ] 既存の認証ユースケースを削除
- [ ] 既存のリポジトリを削除

### 7.2 依存関係の整理

- [ ] 不要なパッケージを削除
- [ ] `package.json`を更新
- [ ] `package-lock.json`を更新

### 7.3 テストファイルの整理

- [ ] 不要なテストファイルを削除
- [ ] テスト設定を更新
- [ ] テストが正常に実行されることを確認

## 🎉 最終確認

### 8.1 ビルドとデプロイ

- [ ] `npm run build`が成功する
- [ ] `npm run type-check`が成功する
- [ ] 本番環境でのデプロイが成功する
- [ ] 本番環境でアプリケーションが正常に動作する

### 8.2 パフォーマンスの確認

- [ ] ページ読み込み速度が向上している
- [ ] ビルド時間が短縮されている
- [ ] バンドルサイズが削減されている

### 8.3 セキュリティの確認

- [ ] 認証が適切に動作している
- [ ] セッション管理が安全
- [ ] パスワードが適切にハッシュ化されている
- [ ] CORS設定が適切

### 8.4 ドキュメントの更新

- [ ] README.mdが更新されている
- [ ] 移行ガイドが完成している
- [ ] APIドキュメントが更新されている
- [ ] 開発者向けドキュメントが更新されている

## ✅ 移行完了の判定

すべてのチェック項目が完了した場合、Supabase認証への移行は成功です。

### 移行完了の基準

- [ ] すべてのPhaseが完了している
- [ ] すべてのテストが通っている
- [ ] 本番環境で正常に動作している
- [ ] パフォーマンスが向上している
- [ ] セキュリティが確保されている

## 🚨 問題が発生した場合

移行中に問題が発生した場合：

1. **ロールバック**: バックアップから復元
2. **調査**: エラーログを確認
3. **修正**: 問題を特定して修正
4. **再テスト**: 修正後に再テスト
5. **再移行**: 問題が解決したら再移行

## 📞 サポート

移行中に問題が発生した場合：

- Supabaseドキュメントを確認
- プロジェクトのIssuesで報告
- コミュニティフォーラムで質問
